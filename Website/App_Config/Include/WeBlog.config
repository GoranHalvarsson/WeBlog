<?xml version="1.0"?>
<configuration xmlns:x="http://www.sitecore.net/xmlconfig/">
  <sitecore>
    <sc.variable name="EntryTemplateID" value="{5FA92FF4-4AC2-48E2-92EB-E1E4914677B0}"/>
    <sc.variable name="BlogTemplateID" value="{46663E05-A6B8-422A-8E13-36CD2B041278}"/>
    <sc.variable name="CategoryTemplateID" value="{61FF8D49-90D7-4E59-878D-DF6E03400D3B}"/>
    <sc.variable name="CommentTemplateID" value="{70949D4E-35D8-4581-A7A2-52928AA119D5}"/>
    <sc.variable name="BlogBranchTemplateID" value="{6FC4278C-E043-458B-9D5D-BBA775A9C386}"/>
    <sc.variable name="RSSFeedTemplateID" value="{B960CBE4-381F-4A2B-9F44-A43C7A991A0B}"/>
    <events>
      <event name="item:saved">
        <handler type="Sitecore.Sharedsource.Tasks.NewsMover, Sitecore.Sharedsource.NewsMover" method="OnItemSaved">
          <database>master</database>
          <datefield>__created</datefield>
          <articletemplate>modules/WeBlog/BlogEntry</articletemplate>
          <yeartemplate>common/folder</yeartemplate>
          <monthtemplate>common/folder</monthtemplate>
          <!-- Uncomment the following line if you have too many posts per month (more than 100) -->
          <!--<daytemplate>common/folder</daytemplate>-->
        </handler>
        <!-- The patch attribute below is arbitrary and required for the Sitecore config patcher to see this element separate to the previous one -->
        <handler type="Sitecore.Sharedsource.Tasks.NewsMover, Sitecore.Sharedsource.NewsMover" method="OnItemSaved" patch="additional">
          <database>master</database>
          <datefield>__created</datefield>
          <articletemplate>modules/WeBlog/BlogComment</articletemplate>
          <yeartemplate>common/folder</yeartemplate>
          <monthtemplate>common/folder</monthtemplate>
          <!-- Uncomment the following line if you have too many comments per post for any given month (more than 100) -->
          <!--<daytemplate>common/folder</daytemplate>-->
        </handler>
      </event>
    </events>
    <commands>
      <command name="blog:newblog" type="Sitecore.Modules.WeBlog.Commands.NewBlog,Sitecore.Modules.WeBlog"/>
      <command name="blog:newentry" type="Sitecore.Modules.WeBlog.Commands.NewEntry,Sitecore.Modules.WeBlog"/>
      <command name="blog:newcategory" type="Sitecore.Modules.WeBlog.Commands.NewCategory,Sitecore.Modules.WeBlog"/>
      <command name="blog:blogsettings" type="Sitecore.Modules.WeBlog.Commands.EditBlogSettings,Sitecore.Modules.WeBlog"/>
      <command name="blog:entrysettings" type="Sitecore.Modules.WeBlog.Commands.EditEntrySettings,Sitecore.Modules.WeBlog"/>
      <command name="blog:import" type="Sitecore.Modules.WeBlog.Commands.Import,Sitecore.Modules.WeBlog"/>
      <command name="blog:rebuildindex" type="Sitecore.Modules.WeBlog.Commands.RebuildIndex,Sitecore.Modules.WeBlog"/>
    </commands>
    <settings>
      <!-- Blog.CommentService.Enable: 
            Enable this setting to submit comments to a separate server using WCF.
            Used in a multi-server setup  -->
      <setting name="Blog.CommentService.Enable" value="false"/>

      <!-- To use reCAPTCHA instead of the default captcha:
                * In the Entry template's Standard Values, remove the SitecoreCaptcha sublayout
                * Add the reCAPTCHA sublayout to the phBlogCommentForm placeholder
                * Uncomment the settings below and enter your reCAPTCHA keys
                * Publish
      -->
      <!--
      <setting name="WeBlog.reCAPTCHA.PrivateKey" value=""/>
      <setting name="WeBlog.reCAPTCHA.PublicKey" value=""/>
      -->
      
      <!-- To enable AddThis Analytics, enter your AddThis account name. -->
      <setting name="Blog.AddThisAccountName" value=""/>
        
      <!-- To enable ShareThis:
                * In the Entry template's Standard Values, remove the ShareEntry-AddThis sublayout
                * Add the ShareEntry-ShareThis sublayout to the phBlogBelowEntry placeholder
                * Add your ShareThis publisher ID below (this appears to be required for ShareThis)
                * Publish
      -->
      <setting name="Blog.ShareThisPublisherID" value=""/>
        
      <!-- TemplateIDs: 
            Various templateIDs which are used in the business logic
      -->
      <setting name="Blog.EntryTemplateID" value="$(EntryTemplateID)" />
      <setting name="Blog.BlogTemplateID" value="$(BlogTemplateID)" />
      <setting name="Blog.CategoryTemplateID" value="$(CategoryTemplateID)" />
      <setting name="Blog.CommentTemplateID" value="$(CommentTemplateID)" />
      <setting name="Blog.BlogBranchTemplateID" value="$(BlogBranchTemplateID)" />
      <setting name="Blog.RSSFeedTemplateID" value="$(RSSFeedTemplateID)" />
        
      <!-- Blog settings paths -->
      <!--<setting name="Blog.SettingsRoot" value="/sitecore/system/Modules/Blog/Blogs"/>-->
      <!-- Blog.ThemesRoot: Path to item containing all available blog themes -->
      <setting name="Blog.ThemesRoot" value="/sitecore/system/Modules/WeBlog/Themes"/>
      
      <!-- Blog.ContentRootPath: Path under which all blogs are located -->
      <setting name="Blog.ContentRootPath" value="/sitecore/content"/>
      
      <!-- Gravatar settings -->
      <setting name="Blog.Gravatar.ImageService.Url" value="http://www.gravatar.com/avatar"/>
      
      <!-- Search index settings -->
      <setting name="Blog.SearchIndexName" value="WeBlog"/>
    </settings>
    <databases>
      <database id="web">
        <!--singleInstance="true" type="Sitecore.Data.Database, Sitecore.Kernel"-->
        <Engines.HistoryEngine.Storage>
          <obj type="Sitecore.Data.$(database).$(database)HistoryStorage, Sitecore.Kernel">
            <param connectionStringName="$(id)" />
            <EntryLifeTime>30.00:00:00</EntryLifeTime>
          </obj>
        </Engines.HistoryEngine.Storage>
        <Engines.HistoryEngine.SaveDotNetCallStack>false</Engines.HistoryEngine.SaveDotNetCallStack>
      </database>
    </databases>
    <search>
      <configuration>
        <indexes>
          <index id="WeBlog" type="Sitecore.Search.Index, Sitecore.Kernel">
            <param desc="name">$(id)</param>
            <param desc="folder">WeBlog</param>
            <Analyzer ref="search/analyzer"/>
            <locations hint="list:AddCrawler">
              <web type="Sitecore.Modules.WeBlog.Search.Crawlers.DatabaseCrawler,Sitecore.Modules.WeBlog">
                <!-- Don't index all fields so we can control the values and fields in the index -->
                <IndexAllFields>false</IndexAllFields>
                <Database>web</Database>
                <Root>/sitecore/content</Root>
                <include hint="list:IncludeTemplate" entryTemplate="$(EntryTemplateID)" commentTemplate="$(CommentTemplateID)">
                  <entry>$(entryTemplate)</entry>
                  <comment>$(commentTemplate)</comment>
                </include>
                <multiListFields hint="list:AddMultilistField">
                  <category>category</category>
                </multiListFields>
                <includeFields hint="list:AddDataField">
                  <!--<created>__created</created>-->
                  <tags>tags</tags>
                </includeFields>
                <tags>WeBlog</tags>
              </web>
            </locations>
          </index>
        </indexes>
      </configuration>
    </search>
    <!-- TODO: Do we need a history engine for the web DB? -->
  </sitecore>
</configuration>
  
<!-- Multi Server Setup:
To have Blog run in a multi-server environment the comment submissions must be posted from the delivery server
through a WCF service hosted by the authoring server. Use the following configuration samples to configure the server
on your authoring server and the client on the delivery server. Configuration must be placed in your web.config file.
The Sitecore patch utility cannot patch non-Sitecore elements.

WCF Server (Sitecore authoring server):

<configuration>
  <system.serviceModel>
    <behaviors>
      <serviceBehaviors>
        <behavior name="Sitecore.Modules.WeBlog.Services.CommentServiceBehaviour">
          <serviceMetadata httpGetEnabled="true" />
          <serviceDebug includeExceptionDetailInFaults="true" />
        </behavior>
      </serviceBehaviors>
    </behaviors>
    <services>
      <service name="Sitecore.Modules.WeBlog.Services.CommentService"
        behaviorConfiguration="Sitecore.Modules.WeBlog.Services.CommentServiceBehaviour">
        <endpoint address="" binding="wsHttpBinding" contract="Sitecore.Modules.WeBlog.Services.ICommentService">
          <identity>
            <dns value="localhost" />
          </identity>
        </endpoint>
      </service>
    </services>
  </system.serviceModel>
</configuration>

WCF Client (Sitecore delivery server):

<configuration>
  <system.serviceModel>
	  <client>
      <endpoint address="http://[authoring server address]/sitecore modules/Blog/Comment.svc"
        binding="wsHttpBinding" contract="Sitecore.Modules.WeBlog.Services.ICommentService"
        name="BlogCommentService">
        <identity>
          <dns value="localhost" />
        </identity>
      </endpoint>
    </client>
  </system.serviceModel>
</configuration>

Replace [authoring server address] above with the address of the application hosting the WCF server (Sitecore 
authoring server).
-->